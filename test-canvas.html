<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no"/>
  <title>用户中心-安美拉</title>
  <!-- <script src='./jquery.js'></script> -->
  <style>
  * {
    margin: 0;
    padding: 0;
  }
  body {
    background-color: black;
/*    background-image: url('./test.jpg');
    background-repeat: no-repeat;
    background-size: 100% 100%;
    background-position: center center; */
  }

  input {
    position: absolute;
    bottom: 10px;
    left: 100px;
  }

  #canvas {
  }

  </style>
</head>
<body>
  <div class='wrapper'>
    <canvas id="canvas" width="600" height="600"></canvas>
  </div>
</body>

<script>
window.onload= function () {
  var canvas = document.getElementById('canvas');
  var ctx = canvas.getContext('2d');
  var t = .05; // t定时器时间间隔.1s

  // 粒子运动总开关
  var flag = true;


  // 定义

  var ballArry = [];

  var Ball = function (direction) {
    // 初始速度
    this.vx0 =  (direction === 'left') ? (Math.random() * 30 + 10): -(Math.random() * 30 + 10);
    this.vy0 = 0;

    // 初始坐标
    this.initeX = direction === 'left' ? 10: (canvas.width - 10); 
    this.initeY = 10;

    // 移动距离
    this.disX = 0; 
    this.disY = 0;

    // 时间t
    this.t = 0;

    // 加速度
    this.speedX = direction === 'left' ? 1: -1;
    this.speedY = Math.random()*10 + 5;

    // 颜色
    this.color = 'rgba(' + Math.random() * 255 + ',' + Math.random() * 255 + ',' +  Math.random() * 255 + ',' + (Math.random() * .1 + .9) + ')';

    // 半径


  }

  // 绘制
  Ball.prototype.render = function () {
    // 重绘
     // clear canvas

    // start
    ctx.save();

    ctx.beginPath();
    // 绘制圆
    ctx.fillStyle= this.color;
    ctx.arc(this.disX, this.disY,5, 0, Math.PI*2, true);
    ctx.fill();

    // close
    ctx.restore();
  }

  // 更新 S=V0t+1/2at^2
  Ball.prototype.update = function () {
    this.goDie();

    this.t+=t;

    this.disX = this.initeX + this.vx0 * this.t;
    this.disY = this.initeY + this.vy0 * this.t + this.speedY * Math.pow(this.t, 2) / 2;
    this.render();
  }

  // 判断消失
  Ball.prototype.goDie = function () {
    // 判断是否出画面
    if (this.disX >= canvas.height) {
      ballArry.splice(this, 1);
      return;
    }
  }

  // 生成粒子

  generateBall = null;
  var generateBall = setInterval(function () {
    if (!flag) {
      clearTimeout(generateBall);
    }
    ballArry.push(new Ball('left'));
    ballArry.push(new Ball('right'));
  }, 180);

  moveTimer = null;
  var moveTimer = setInterval(function () {

    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (!flag) {
      clearInterval(moveTimer);
    }

    for (var i = 0; i < ballArry.length; i++) {
      console.log('length', ballArry.length);
      ballArry[i].update();
    }

  }, 20);

}
</script>
</html>